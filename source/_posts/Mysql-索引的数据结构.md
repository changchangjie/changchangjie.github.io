---
title: Mysql-索引的数据结构
date: 2018-11-09 17:00:00
categories: 
- Mysql
---

索引能够使每次查找数据时把磁盘IO次数控制在一个很小的数量级
Mysql索引的数据结构是b+树
<!--more-->

### b+树的数据结构
![](https://tech.meituan.com/img/mysql_index/btree.jpg)
浅蓝色的块我们称之为一个磁盘块，可以看到每个磁盘块包含几个数据项（深蓝色所示）和指针（黄色所示），如磁盘块1包含数据项17和35，包含指针P1、P2、P3，P1表示小于17的磁盘块，P2表示在17和35之间的磁盘块，P3表示大于35的磁盘块。真实的数据存在于叶子节点即3、5、9、10、13、15、28、29、36、60、75、79、90、99。非叶子节点只不存储真实的数据，只存储指引搜索方向的数据项，如17、35并不真实存在于数据表中

### b+树的查找过程
如图所示，如果要查找数据项29，那么首先会把磁盘块1由磁盘加载到内存，此时发生一次IO，在内存中用二分查找确定29在17和35之间，锁定磁盘块1的P2指针，内存时间因为非常短（相比磁盘的IO）可以忽略不计，通过磁盘块1的P2指针的磁盘地址把磁盘块3由磁盘加载到内存，发生第二次IO，29在26和30之间，锁定磁盘块3的P2指针，通过指针加载磁盘块8到内存，发生第三次IO，同时内存中做二分查找找到29，结束查询，总计三次IO。真实的情况是，3层的b+树可以表示上百万的数据，如果上百万的数据查找只需要三次IO，性能提高将是巨大的，如果没有索引，每个数据项都要发生一次IO，那么总共需要百万次的IO，显然成本非常非常高

### b+树性质
通过上面的分析，我们知道磁盘IO次数取决于b+数的高度h，树高越低磁盘IO越少
在数据量一定的情况下，为了使树高越低，需要使每个磁盘块存储的数据量越多，
而磁盘块的大小也就是一个数据页的大小，是固定的，为了使存储的数据量越多，则需要使索引字段数据项所占的空间越少，所以需要控制字段类型

### 参考链接
> [MySQL索引原理及慢查询优化](https://tech.meituan.com/mysql_index.html)
> [MySQL 索引及查询优化总结](https://juejin.im/entry/590a973561ff4b00698921b8)



